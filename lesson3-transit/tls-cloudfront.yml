Description: 'Static Web Site'

# "us-east-1-ceoa-tls-pipeline-static-web-buckets"

Parameters:
  BucketName:
    Type: String
    Description: "Bucket Name"
    Default: "www.encryptaws.com"
  DomainName:
    Type: String
    Description: "Domain Name"
    Default: "www.encryptaws.com.s3.amazonaws.com"
  CloudFrontDomainName:
    Type: String
    Description: "CloudFront DomainName"
    Default: ""
  CloudFrontCName:
    Type: String
    Description: "CloudFront CNames"
    Default: "www.encryptaws.com"
  HostedZoneId:
    Type: String
    Description: "Hosted Zone Id"
    Default: "ZLND5TXS03SWZ"

Resources:
  CloudFrontOriginAccessIdentity:
    Type: "AWS::CloudFront::CloudFrontOriginAccessIdentity"
    Properties:
      CloudFrontOriginAccessIdentityConfig:
        Comment: CloudFrontOriginAccessIdentity for TLS Solution

  CloudFront:
    Type: "AWS::CloudFront::Distribution"
    Properties:
      DistributionConfig:
        Aliases: 
          - !Ref CloudFrontCName
        Enabled: true
        Comment: "created by cloudformation"
        ViewerCertificate:
          AcmCertificateArn:
            Fn::ImportValue:
              !Sub "${AWS:Region}-CertificateArn"
          MinimumProtocolVersion: TLSv1.1_2016
          SslSupportMethod: sni-only
        Enabled: true
        Origins:
          - Id: S3-Origin
            DomainName: !Ref 'DomainName' #!GetAtt StaticWebBuckets.DomainName  #StaticWebBuckets.DomainName = xian.cutecherry.info.s3.amazonaws.com
            S3OriginConfig:
              OriginAccessIdentity: !Sub "origin-access-identity/cloudfront/${CloudFrontOriginAccessIdentity}"
        DefaultRootObject: index.html
        DefaultCacheBehavior:
          TargetOriginId: S3-Origin
          ViewerProtocolPolicy: redirect-to-https
          DefaultTTL: 600
          ForwardedValues:
            QueryString: True
            Cookies:
              Forward: all
          Compress: True

  StaticSiteDomainName:
    Type: "AWS::Route53::RecordSet"
    Properties:
      Type: A
      HostedZoneId: !Ref 'HostedZoneId'
      Name: !Ref 'CloudFrontCName'
      AliasTarget:
        DNSName: !GetAtt CloudFront.DomainName  #CloudFront.DomainName = d2y1cxx7cc6yud.cloudfront.net.
        HostedZoneId: Z2FDTNDATAQYW2 #CloudFront Default HostedZoneId